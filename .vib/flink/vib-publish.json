{
  "phases": {
    "package": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        }
      },
      "actions": [
        {
          "action_id": "helm-package"
        },
        {
          "action_id": "helm-lint"
        }
      ]
    },
    "verify": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        },
        "runtime_parameters": "ZXh0cmFEZXBsb3k6CiAgLSB8CiAgICBhcGlWZXJzaW9uOiBiYXRjaC92MQogICAga2luZDogSm9iCiAgICBtZXRhZGF0YToKICAgICAgbmFtZTogZmxpbmstam9iLXJ1bm5lcgogICAgc3BlYzoKICAgICAgdGVtcGxhdGU6CiAgICAgICAgc3BlYzoKICAgICAgICAgIHJlc3RhcnRQb2xpY3k6IE9uRmFpbHVyZQogICAgICAgICAgY29udGFpbmVyczoKICAgICAgICAgICAgLSBuYW1lOiBqb2ItcnVubmVyCiAgICAgICAgICAgICAgaW1hZ2U6IGRvY2tlci5pby9iaXRuYW1pL2ZsaW5rOjEuMTYuMS1kZWJpYW4tMTEtcjAKICAgICAgICAgICAgICBjb21tYW5kOgogICAgICAgICAgICAgICAgLSAvYmluL2Jhc2gKICAgICAgICAgICAgICBhcmdzOgogICAgICAgICAgICAgICAgLSAtZWMKICAgICAgICAgICAgICAgIC0gfAogICAgICAgICAgICAgICAgICAjIS9iaW4vYmFzaAogICAgCiAgICAgICAgICAgICAgICAgIHNldCAtbyBlcnJleGl0CiAgICAgICAgICAgICAgICAgIHNldCAtbyBub3Vuc2V0CiAgICAgICAgICAgICAgICAgIHNldCAtbyBwaXBlZmFpbAogICAgCiAgICAgICAgICAgICAgICAgIC4gL29wdC9iaXRuYW1pL3NjcmlwdHMvbGlib3Muc2gKICAgIAogICAgICAgICAgICAgICAgICBqb2JtYW5hZ2VyX3JlYWR5KCkgewogICAgICAgICAgICAgICAgICAgICAgIyBTZXQgdGhlIGVuZHBvaW50IFVSTAogICAgICAgICAgICAgICAgICAgICAgaG9zdD1mbGluay1qb2JtYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAgICBwb3J0PXt7IC5WYWx1ZXMuam9ibWFuYWdlci5zZXJ2aWNlLnBvcnRzLnJwYyB9fQogICAgCiAgICAgICAgICAgICAgICAgICAgICAjIFRlc3QgdGhlIFRDUCBjb25uZWN0aW9uIHdpdGggYSB0aW1lb3V0CiAgICAgICAgICAgICAgICAgICAgICBpZiB0aW1lb3V0IDUgYmFzaCAtYyAiPC9kZXYvdGNwLyRob3N0LyRwb3J0IjsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICBlY2hvICIwIiA+IC90bXAvcmVhZHkKICAgICAgICAgICAgICAgICAgaW5mbyAiV2FpdGluZyBmb3IgdGhlIEpvYm1hbmFnZXIgaW5zdGFuY2UiCiAgICAgICAgICAgICAgICAgIGlmICEgcmV0cnlfd2hpbGUgImpvYm1hbmFnZXJfcmVhZHkiIDEyIDMwOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXJyb3IgIkNvdWxkIG5vdCBjb25uZWN0IHRvIHRoZSBKb2JtYW5hZ2VyIGluc3RhbmNlIgogICAgICAgICAgICAgICAgICAgIGV4aXQgMQogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaW5mbyAiSm9ibWFuYWdlciByZWFkeSEgUnVubmluZyBqb2IgaW4gMTAgc2Vjb25kcyIKICAgICAgICAgICAgICAgICAgICBzbGVlcCAxMAogICAgICAgICAgICAgICAgICAgIHdoaWxlIHRydWUKICAgICAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgIC4vYmluL2ZsaW5rIHJ1biAuL2V4YW1wbGVzL2JhdGNoL0VudW1UcmlhbmdsZXMuamFyIC0tam9ibWFuYWdlciBmbGluay1qb2JtYW5hZ2VyOnt7IC5WYWx1ZXMuam9ibWFuYWdlci5zZXJ2aWNlLnBvcnRzLnJwYyB9fSAtRHJlc3QucG9ydD17eyAuVmFsdWVzLmpvYm1hbmFnZXIuc2VydmljZS5wb3J0cy5odHRwIH19CiAgICAgICAgICAgICAgICAgICAgZWNobyAiMSIgPiAvdG1wL3JlYWR5CiAgICAgICAgICAgICAgICAgICAgZG9uZQogICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgIHN0YXJ0dXBQcm9iZToKICAgICAgICAgICAgICAgIGV4ZWM6CiAgICAgICAgICAgICAgICAgIGNvbW1hbmQ6CiAgICAgICAgICAgICAgICAgICAgLSBzaAogICAgICAgICAgICAgICAgICAgIC0gLWMKICAgICAgICAgICAgICAgICAgICAtIHwKICAgICAgICAgICAgICAgICAgICAgIGlmIFsgJChjYXQgL3RtcC9yZWFkeSkgPSAiMSIgXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBleGl0IDAKICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgICAgaW5pdGlhbERlbGF5U2Vjb25kczogNDAKICAgICAgICAgICAgICAgIHBlcmlvZFNlY29uZHM6IDIwCiAgICAgICAgICAgICAgICB0aW1lb3V0U2Vjb25kczogMQogICAgICAgICAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogMTUKICAgICAgICAgICAgICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IDEKICAgICAgICAgICAgICB2b2x1bWVNb3VudHM6CiAgICAgICAgICAgICAgICAtIG5hbWU6IGZsaW5rLWNvbmZpZy12b2x1bWUKICAgICAgICAgICAgICAgICAgbW91bnRQYXRoOiAvb3B0L2JpdG5hbWkvZmxpbmsvY29uZgogICAgICAgICAgdm9sdW1lczoKICAgICAgICAgICAgLSBuYW1lOiBmbGluay1jb25maWctdm9sdW1lCiAgICAgICAgICAgICAgY29uZmlnTWFwOgogICAgICAgICAgICAgICAgbmFtZTogZmxpbmstam9iLWNvbmZpZwogICAgICAgICAgICAgICAgaXRlbXM6CiAgICAgICAgICAgICAgICAgIC0ga2V5OiBmbGluay1jb25mLnlhbWwKICAgICAgICAgICAgICAgICAgICBwYXRoOiBmbGluay1jb25mLnlhbWwKCiAgLSB8CiAgICBhcGlWZXJzaW9uOiB2MQogICAga2luZDogQ29uZmlnTWFwCiAgICBtZXRhZGF0YToKICAgICAgbmFtZTogZmxpbmstam9iLWNvbmZpZwogICAgZGF0YToKICAgICAgZmxpbmstY29uZi55YW1sOiB8KwogICAgICAgIGpvYm1hbmFnZXIucnBjLmFkZHJlc3M6IGZsaW5rLWpvYm1hbmFnZXIKICAgICAgICBqb2JtYW5hZ2VyLnJwYy5wb3J0OiA2NTU3CiAgICAgICAgcmVzdC5hZGRyZXNzOiBmbGluay1qb2JtYW5hZ2VyCiAgICAgICAgcmVzdC5iaW5kLWFkZHJlc3M6IDAuMC4wLjAKICAgICAgICBibG9iLnNlcnZlci5wb3J0OiA5MjkyCiAgICAgICAgcmVzdC5wb3J0OiA4MAoKam9ibWFuYWdlcjoKICBjb250YWluZXJQb3J0czoKICAgIHJwYzogNjU1NQogICAgaHR0cDogODA3OAogICAgYmxvYjogOTE5MQogIHNlcnZpY2U6CiAgICB0eXBlOiBMb2FkQmFsYW5jZXIKICAgIHBvcnRzOgogICAgICBycGM6IDY1NTcKICAgICAgaHR0cDogODAKICAgICAgIyBNdXN0IGJlIGVxdWFsIHRvIHRoZSBjb250YWluZXJQb3J0LmJsb2IuIE1vcmUgaW5mbyBpbiB0aGUgdmFsdWVzIGRvY3VtZW50YXRpb24uCiAgICAgIGJsb2I6IDkxOTEKICBwb2RTZWN1cml0eUNvbnRleHQ6CiAgICBmc0dyb3VwOiAxMDAyCiAgY29udGFpbmVyU2VjdXJpdHlDb250ZXh0OgogICAgcnVuQXNVc2VyOiAxMDAyCnRhc2ttYW5hZ2VyOgogIHNlcnZpY2U6CiAgICBwb3J0czoKICAgICAgcnBjOiAxNDI3MgogIGNvbnRhaW5lclBvcnRzOgogICAgcnBjOiA1Nzc5Cg==",
        "target_platform": {
          "target_platform_id": "{VIB_ENV_TARGET_PLATFORM}",
          "size": {
            "name": "M4"
          }
        }
      },
      "actions": [
        {
          "action_id": "health-check",
          "params": {
            "endpoint": "lb-flink-jobmanager-http",
            "app_protocol": "HTTP"
          }
        },
        {
          "action_id": "goss",
          "params": {
            "resources": {
              "path": "/.vib/flink/goss"
            },
            "remote": {
              "workload": "deploy-flink-jobmanager"
            },
            "vars_file": "vars.yaml"
          }
        },
        {
          "action_id": "cypress",
          "params": {
            "resources": {
              "path": "/.vib/flink/cypress"
            },
            "endpoint": "lb-flink-jobmanager-http",
            "app_protocol": "HTTP"
          }
        }
      ]
    },
    "publish": {
      "actions": [
        {
          "action_id": "helm-publish",
          "params": {
            "repository": {
              "kind": "S3",
              "url": "{VIB_ENV_S3_URL}",
              "username": "{VIB_ENV_S3_USERNAME}",
              "password": "{VIB_ENV_S3_PASSWORD}"
            }
          }
        }
      ]
    }
  }
}
