{
  "phases": {
    "package": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        }
      },
      "actions": [
        {
          "action_id": "helm-package"
        },
        {
          "action_id": "helm-lint"
        }
      ]
    },
    "verify": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        },
        "runtime_parameters": "ZXh0cmFEZXBsb3k6CiAgLSB8CiAgICBhcGlWZXJzaW9uOiBiYXRjaC92MQogICAga2luZDogSm9iCiAgICBtZXRhZGF0YToKICAgICAgbmFtZTogZmxpbmstam9iLXJ1bm5lcgogICAgICBuYW1lc3BhY2U6IHt7IGluY2x1ZGUgImNvbW1vbi5uYW1lcy5uYW1lc3BhY2UiIC4gfCBxdW90ZSB9fQogICAgICBsYWJlbHM6IHt7LSBpbmNsdWRlICJjb21tb24ubGFiZWxzLnN0YW5kYXJkIiAuIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGlmIC5WYWx1ZXMuY29tbW9uTGFiZWxzIH19CiAgICAgICAge3stIGluY2x1ZGUgImNvbW1vbi50cGx2YWx1ZXMucmVuZGVyIiAoIGRpY3QgInZhbHVlIiAuVmFsdWVzLmNvbW1vbkxhYmVscyAiY29udGV4dCIgJCApIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGVuZCB9fQogICAgICAgIGFwcC5rdWJlcm5ldGVzLmlvL3BhcnQtb2Y6IGZsaW5rCiAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vY29tcG9uZW50OiBqb2JtYW5hZ2VyCiAgICAgIHt7LSBpZiAuVmFsdWVzLmNvbW1vbkFubm90YXRpb25zIH19CiAgICAgIGFubm90YXRpb25zOiB7ey0gaW5jbHVkZSAiY29tbW9uLnRwbHZhbHVlcy5yZW5kZXIiICggZGljdCAidmFsdWUiIC5WYWx1ZXMuY29tbW9uQW5ub3RhdGlvbnMgImNvbnRleHQiICQgKSB8IG5pbmRlbnQgNCB9fQogICAgICB7ey0gZW5kIH19CiAgICBzcGVjOgogICAgICB0ZW1wbGF0ZToKICAgICAgICBtZXRhZGF0YToKICAgICAgICAgIGxhYmVsczoge3stIGluY2x1ZGUgImNvbW1vbi5sYWJlbHMuc3RhbmRhcmQiIC4gfCBuaW5kZW50IDggfX0KICAgICAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vcGFydC1vZjogZmxpbmsKICAgICAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vY29tcG9uZW50OiBqb2JtYW5hZ2VyCiAgICAgICAgICAgIHt7LSBpZiAuVmFsdWVzLmpvYm1hbmFnZXIucG9kTGFiZWxzIH19CiAgICAgICAgICAgIHt7LSBpbmNsdWRlICJjb21tb24udHBsdmFsdWVzLnJlbmRlciIgKGRpY3QgInZhbHVlIiAuVmFsdWVzLmpvYm1hbmFnZXIucG9kTGFiZWxzICJjb250ZXh0IiAkKSB8IG5pbmRlbnQgOCB9fQogICAgICAgICAgICB7ey0gZW5kIH19CiAgICAgICAgICB7ey0gaWYgLlZhbHVlcy5qb2JtYW5hZ2VyLnBvZEFubm90YXRpb25zIH19CiAgICAgICAgICBhbm5vdGF0aW9uczoKICAgICAgICAgICAge3stIGlmIC5WYWx1ZXMuam9ibWFuYWdlci5wb2RBbm5vdGF0aW9ucyB9fQogICAgICAgICAgICB7ey0gaW5jbHVkZSAiY29tbW9uLnRwbHZhbHVlcy5yZW5kZXIiIChkaWN0ICJ2YWx1ZSIgLlZhbHVlcy5qb2JtYW5hZ2VyLnBvZEFubm90YXRpb25zICJjb250ZXh0IiAkKSB8IG5pbmRlbnQgOCB9fQogICAgICAgICAgICB7ey0gZW5kIH19CiAgICAgICAgICB7ey0gZW5kIH19CiAgICAgICAgc3BlYzoKICAgICAgICAgIHJlc3RhcnRQb2xpY3k6IE9uRmFpbHVyZQogICAgICAgICAgY29udGFpbmVyczoKICAgICAgICAgICAgLSBuYW1lOiBqb2ItcnVubmVyCiAgICAgICAgICAgICAgaW1hZ2U6IGRvY2tlci5pby9iaXRuYW1pL2ZsaW5rOjEuMTYuMS1kZWJpYW4tMTEtcjAKICAgICAgICAgICAgICBpbWFnZVB1bGxQb2xpY3k6IHt7IC5WYWx1ZXMuaW1hZ2UucHVsbFBvbGljeSB8IHF1b3RlIH19CiAgICAgICAgICAgICAgY29tbWFuZDoKICAgICAgICAgICAgICAgIC0gL2Jpbi9iYXNoCiAgICAgICAgICAgICAgYXJnczoKICAgICAgICAgICAgICAgIC0gLWVjCiAgICAgICAgICAgICAgICAtIHwKICAgICAgICAgICAgICAgICAgIyEvYmluL2Jhc2gKICAgIAogICAgICAgICAgICAgICAgICBzZXQgLW8gZXJyZXhpdAogICAgICAgICAgICAgICAgICBzZXQgLW8gbm91bnNldAogICAgICAgICAgICAgICAgICBzZXQgLW8gcGlwZWZhaWwKICAgIAogICAgICAgICAgICAgICAgICAuIC9vcHQvYml0bmFtaS9zY3JpcHRzL2xpYm9zLnNoCiAgICAKICAgICAgICAgICAgICAgICAgam9ibWFuYWdlcl9yZWFkeSgpIHsKICAgICAgICAgICAgICAgICAgICAgICMgU2V0IHRoZSBlbmRwb2ludCBVUkwKICAgICAgICAgICAgICAgICAgICAgIGhvc3Q9Zmxpbmstam9ibWFuYWdlcgogICAgICAgICAgICAgICAgICAgICAgcG9ydD17eyAuVmFsdWVzLmpvYm1hbmFnZXIuY29udGFpbmVyUG9ydHMucnBjIH19CiAgICAKICAgICAgICAgICAgICAgICAgICAgICMgVGVzdCB0aGUgVENQIGNvbm5lY3Rpb24gd2l0aCBhIHRpbWVvdXQKICAgICAgICAgICAgICAgICAgICAgIGlmIHRpbWVvdXQgNSBiYXNoIC1jICI8L2Rldi90Y3AvJGhvc3QvJHBvcnQiOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICAgICAgIGVjaG8gIjAiID4gL3RtcC9yZWFkeQogICAgICAgICAgICAgICAgICBpbmZvICJXYWl0aW5nIGZvciB0aGUgSm9ibWFuYWdlciBpbnN0YW5jZSIKICAgICAgICAgICAgICAgICAgaWYgISByZXRyeV93aGlsZSAiam9ibWFuYWdlcl9yZWFkeSIgMTIgMzA7IHRoZW4KICAgICAgICAgICAgICAgICAgICBlcnJvciAiQ291bGQgbm90IGNvbm5lY3QgdG8gdGhlIEpvYm1hbmFnZXIgaW5zdGFuY2UiCiAgICAgICAgICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpbmZvICJKb2JtYW5hZ2VyIHJlYWR5ISBSdW5uaW5nIGpvYiBpbiAxMCBzZWNvbmRzIgogICAgICAgICAgICAgICAgICAgIHNsZWVwIDEwCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZQogICAgICAgICAgICAgICAgICAgIGRvCiAgICAgICAgICAgICAgICAgICAgLi9iaW4vZmxpbmsgcnVuIC4vZXhhbXBsZXMvYmF0Y2gvRW51bVRyaWFuZ2xlcy5qYXIgLS1qb2JtYW5hZ2VyIGZsaW5rLWpvYm1hbmFnZXI6NjEyMyAtRHJlc3QucG9ydD04MAogICAgICAgICAgICAgICAgICAgIGVjaG8gIjEiID4gL3RtcC9yZWFkeQogICAgICAgICAgICAgICAgICAgIGRvbmUKICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICBzdGFydHVwUHJvYmU6CiAgICAgICAgICAgICAgICBleGVjOgogICAgICAgICAgICAgICAgICBjb21tYW5kOgogICAgICAgICAgICAgICAgICAgIC0gc2gKICAgICAgICAgICAgICAgICAgICAtIC1jCiAgICAgICAgICAgICAgICAgICAgLSB8CiAgICAgICAgICAgICAgICAgICAgICBpZiBbICQoY2F0IC90bXAvcmVhZHkpID0gIjEiIF07IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCAwCiAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXQgMQogICAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIGluaXRpYWxEZWxheVNlY29uZHM6IDQwCiAgICAgICAgICAgICAgICBwZXJpb2RTZWNvbmRzOiAyMAogICAgICAgICAgICAgICAgdGltZW91dFNlY29uZHM6IDEKICAgICAgICAgICAgICAgIGZhaWx1cmVUaHJlc2hvbGQ6IDE1CiAgICAgICAgICAgICAgICBzdWNjZXNzVGhyZXNob2xkOiAxCiAgICAgICAgICAgICAgdm9sdW1lTW91bnRzOgogICAgICAgICAgICAgICAgLSBuYW1lOiBmbGluay1jb25maWctdm9sdW1lCiAgICAgICAgICAgICAgICAgIG1vdW50UGF0aDogL29wdC9iaXRuYW1pL2ZsaW5rL2NvbmYKICAgICAgICAgIHZvbHVtZXM6CiAgICAgICAgICAgIC0gbmFtZTogZmxpbmstY29uZmlnLXZvbHVtZQogICAgICAgICAgICAgIGNvbmZpZ01hcDoKICAgICAgICAgICAgICAgIG5hbWU6IGZsaW5rLWpvYi1jb25maWcKICAgICAgICAgICAgICAgIGl0ZW1zOgogICAgICAgICAgICAgICAgICAtIGtleTogZmxpbmstY29uZi55YW1sCiAgICAgICAgICAgICAgICAgICAgcGF0aDogZmxpbmstY29uZi55YW1sCgogIC0gfAogICAgYXBpVmVyc2lvbjogdjEKICAgIGtpbmQ6IENvbmZpZ01hcAogICAgbWV0YWRhdGE6CiAgICAgIG5hbWU6IGZsaW5rLWpvYi1jb25maWcKICAgICAgbmFtZXNwYWNlOiB7eyBpbmNsdWRlICJjb21tb24ubmFtZXMubmFtZXNwYWNlIiAuIHwgcXVvdGUgfX0KICAgICAgbGFiZWxzOiB7ey0gaW5jbHVkZSAiY29tbW9uLmxhYmVscy5zdGFuZGFyZCIgLiB8IG5pbmRlbnQgNCB9fQogICAgICAgIHt7LSBpZiAuVmFsdWVzLmNvbW1vbkxhYmVscyB9fQogICAgICAgIHt7LSBpbmNsdWRlICJjb21tb24udHBsdmFsdWVzLnJlbmRlciIgKCBkaWN0ICJ2YWx1ZSIgLlZhbHVlcy5jb21tb25MYWJlbHMgImNvbnRleHQiICQgKSB8IG5pbmRlbnQgNCB9fQogICAgICAgIHt7LSBlbmQgfX0KICAgICAgICBhcHAua3ViZXJuZXRlcy5pby9wYXJ0LW9mOiBmbGluawogICAgICAgIGFwcC5rdWJlcm5ldGVzLmlvL2NvbXBvbmVudDogam9ibWFuYWdlcgogICAgICB7ey0gaWYgLlZhbHVlcy5jb21tb25Bbm5vdGF0aW9ucyB9fQogICAgICBhbm5vdGF0aW9uczoge3stIGluY2x1ZGUgImNvbW1vbi50cGx2YWx1ZXMucmVuZGVyIiAoIGRpY3QgInZhbHVlIiAuVmFsdWVzLmNvbW1vbkFubm90YXRpb25zICJjb250ZXh0IiAkICkgfCBuaW5kZW50IDQgfX0KICAgICAge3stIGVuZCB9fQogICAgZGF0YToKICAgICAgZmxpbmstY29uZi55YW1sOiB8KwogICAgICAgIGpvYm1hbmFnZXIucnBjLmFkZHJlc3M6IGZsaW5rLWpvYm1hbmFnZXIKICAgICAgICBqb2JtYW5hZ2VyLnJwYy5wb3J0OiA2MTIzCiAgICAgICAgcmVzdC5hZGRyZXNzOiBmbGluay1qb2JtYW5hZ2VyCiAgICAgICAgcmVzdC5iaW5kLWFkZHJlc3M6IDAuMC4wLjAKICAgICAgICBibG9iLnNlcnZlci5wb3J0OiA2MTI0CiAgICAgICAgcXVlcnkuc2VydmVyLnBvcnQ6IDYxMjUKICAgICAgICByZXN0LnBvcnQ6IDgwCgpqb2JtYW5hZ2VyOgogIGNvbnRhaW5lclBvcnRzOgogICAgcnBjOiA2MTIzCiAgICBodHRwOiA4MDc4CiAgc2VydmljZToKICAgIHR5cGU6IExvYWRCYWxhbmNlcgogICAgcG9ydHM6CiAgICAgIHJwYzogNjEyMwogICAgICBodHRwOiA4MAp0YXNrbWFuYWdlcjoKICBzZXJ2aWNlOgogICAgcG9ydHM6CiAgICAgIHJwYzogMTQyNzIKICBjb250YWluZXJQb3J0czoKICAgIHJwYzogNTc3OQogIHBvZFNlY3VyaXR5Q29udGV4dDoKICAgIGZzR3JvdXA6IDEwMDIKICBjb250YWluZXJTZWN1cml0eUNvbnRleHQ6CiAgICBydW5Bc1VzZXI6IDEwMDIK",
        "target_platform": {
          "target_platform_id": "{VIB_ENV_TARGET_PLATFORM}",
          "size": {
            "name": "M4"
          }
        }
      },
      "actions": [
        {
          "action_id": "health-check",
          "params": {
            "endpoint": "lb-flink-jobmanager-http",
            "app_protocol": "HTTP"
          }
        },
        {
          "action_id": "goss",
          "params": {
            "resources": {
              "path": "/.vib/flink/goss"
            },
            "remote": {
              "workload": "deploy-flink-jobmanager"
            },
            "vars_file": "vars.yaml"
          }
        },
        {
          "action_id": "cypress",
          "params": {
            "resources": {
              "path": "/.vib/flink/cypress"
            },
            "endpoint": "lb-flink-jobmanager-http",
            "app_protocol": "HTTP"
          }
        }
      ]
    },
    "publish": {
      "actions": [
        {
          "action_id": "helm-publish",
          "params": {
            "repository": {
              "kind": "S3",
              "url": "{VIB_ENV_S3_URL}",
              "username": "{VIB_ENV_S3_USERNAME}",
              "password": "{VIB_ENV_S3_PASSWORD}"
            }
          }
        }
      ]
    }
  }
}
