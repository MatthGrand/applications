{
  "phases": {
    "package": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        }
      },
      "actions": [
        {
          "action_id": "helm-package"
        },
        {
          "action_id": "helm-lint"
        }
      ]
    },
    "verify": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        },
        "runtime_parameters": "ZXh0cmFEZXBsb3k6CiAgLSB8CiAgICBhcGlWZXJzaW9uOiBiYXRjaC92MQogICAga2luZDogSm9iCiAgICBtZXRhZGF0YToKICAgICAgbmFtZTogZmxpbmstam9iLXJ1bm5lcgogICAgICBuYW1lc3BhY2U6IHt7IGluY2x1ZGUgImNvbW1vbi5uYW1lcy5uYW1lc3BhY2UiIC4gfCBxdW90ZSB9fQogICAgICBsYWJlbHM6IHt7LSBpbmNsdWRlICJjb21tb24ubGFiZWxzLnN0YW5kYXJkIiAuIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGlmIC5WYWx1ZXMuY29tbW9uTGFiZWxzIH19CiAgICAgICAge3stIGluY2x1ZGUgImNvbW1vbi50cGx2YWx1ZXMucmVuZGVyIiAoIGRpY3QgInZhbHVlIiAuVmFsdWVzLmNvbW1vbkxhYmVscyAiY29udGV4dCIgJCApIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGVuZCB9fQogICAgICAgIGFwcC5rdWJlcm5ldGVzLmlvL3BhcnQtb2Y6IGZsaW5rCiAgICAgIHt7LSBpZiAuVmFsdWVzLmNvbW1vbkFubm90YXRpb25zIH19CiAgICAgIGFubm90YXRpb25zOiB7ey0gaW5jbHVkZSAiY29tbW9uLnRwbHZhbHVlcy5yZW5kZXIiICggZGljdCAidmFsdWUiIC5WYWx1ZXMuY29tbW9uQW5ub3RhdGlvbnMgImNvbnRleHQiICQgKSB8IG5pbmRlbnQgNCB9fQogICAgICB7ey0gZW5kIH19CiAgICBzcGVjOgogICAgICB0ZW1wbGF0ZToKICAgICAgICBtZXRhZGF0YToKICAgICAgICAgIGxhYmVsczoge3stIGluY2x1ZGUgImNvbW1vbi5sYWJlbHMuc3RhbmRhcmQiIC4gfCBuaW5kZW50IDggfX0KICAgICAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vcGFydC1vZjogZmxpbmsKICAgICAgICAgICAge3stIGlmIC5WYWx1ZXMuam9ibWFuYWdlci5wb2RMYWJlbHMgfX0KICAgICAgICAgICAge3stIGluY2x1ZGUgImNvbW1vbi50cGx2YWx1ZXMucmVuZGVyIiAoZGljdCAidmFsdWUiIC5WYWx1ZXMuam9ibWFuYWdlci5wb2RMYWJlbHMgImNvbnRleHQiICQpIHwgbmluZGVudCA4IH19CiAgICAgICAgICAgIHt7LSBlbmQgfX0KICAgICAgICAgIHt7LSBpZiAuVmFsdWVzLmpvYm1hbmFnZXIucG9kQW5ub3RhdGlvbnMgfX0KICAgICAgICAgIGFubm90YXRpb25zOgogICAgICAgICAgICB7ey0gaWYgLlZhbHVlcy5qb2JtYW5hZ2VyLnBvZEFubm90YXRpb25zIH19CiAgICAgICAgICAgIHt7LSBpbmNsdWRlICJjb21tb24udHBsdmFsdWVzLnJlbmRlciIgKGRpY3QgInZhbHVlIiAuVmFsdWVzLmpvYm1hbmFnZXIucG9kQW5ub3RhdGlvbnMgImNvbnRleHQiICQpIHwgbmluZGVudCA4IH19CiAgICAgICAgICAgIHt7LSBlbmQgfX0KICAgICAgICAgIHt7LSBlbmQgfX0KICAgICAgICBzcGVjOgogICAgICAgICAgcmVzdGFydFBvbGljeTogT25GYWlsdXJlCiAgICAgICAgICBjb250YWluZXJzOgogICAgICAgICAgICAtIG5hbWU6IGpvYi1ydW5uZXIKICAgICAgICAgICAgICBpbWFnZTogZG9ja2VyLmlvL2JpdG5hbWkvZmxpbms6MS4xNi4xLWRlYmlhbi0xMS1yMAogICAgICAgICAgICAgIGltYWdlUHVsbFBvbGljeToge3sgLlZhbHVlcy5pbWFnZS5wdWxsUG9saWN5IHwgcXVvdGUgfX0KICAgICAgICAgICAgICBjb21tYW5kOgogICAgICAgICAgICAgICAgLSAvYmluL2Jhc2gKICAgICAgICAgICAgICBhcmdzOgogICAgICAgICAgICAgICAgLSAtZWMKICAgICAgICAgICAgICAgIC0gfAogICAgICAgICAgICAgICAgICAjIS9iaW4vYmFzaAogICAgCiAgICAgICAgICAgICAgICAgIHNldCAtbyBlcnJleGl0CiAgICAgICAgICAgICAgICAgIHNldCAtbyBub3Vuc2V0CiAgICAgICAgICAgICAgICAgIHNldCAtbyBwaXBlZmFpbAogICAgCiAgICAgICAgICAgICAgICAgIC4gL29wdC9iaXRuYW1pL3NjcmlwdHMvbGlib3Muc2gKICAgIAogICAgICAgICAgICAgICAgICBqb2JtYW5hZ2VyX3JlYWR5KCkgewogICAgICAgICAgICAgICAgICAgICAgIyBTZXQgdGhlIGVuZHBvaW50IFVSTAogICAgICAgICAgICAgICAgICAgICAgaG9zdD1mbGluay1qb2JtYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAgICBwb3J0PXt7IC5WYWx1ZXMuam9ibWFuYWdlci5zZXJ2aWNlLnBvcnRzLnJwYyB9fQogICAgCiAgICAgICAgICAgICAgICAgICAgICAjIFRlc3QgdGhlIFRDUCBjb25uZWN0aW9uIHdpdGggYSB0aW1lb3V0CiAgICAgICAgICAgICAgICAgICAgICBpZiB0aW1lb3V0IDUgYmFzaCAtYyAiPC9kZXYvdGNwLyRob3N0LyRwb3J0IjsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICBlY2hvICIwIiA+IC90bXAvcmVhZHkKICAgICAgICAgICAgICAgICAgaW5mbyAiV2FpdGluZyBmb3IgdGhlIEpvYm1hbmFnZXIgaW5zdGFuY2UiCiAgICAgICAgICAgICAgICAgIGlmICEgcmV0cnlfd2hpbGUgImpvYm1hbmFnZXJfcmVhZHkiIDEyIDMwOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXJyb3IgIkNvdWxkIG5vdCBjb25uZWN0IHRvIHRoZSBKb2JtYW5hZ2VyIGluc3RhbmNlIgogICAgICAgICAgICAgICAgICAgIGV4aXQgMQogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaW5mbyAiSm9ibWFuYWdlciByZWFkeSEgUnVubmluZyBqb2IgaW4gMTAgc2Vjb25kcyIKICAgICAgICAgICAgICAgICAgICBzbGVlcCAxMAogICAgICAgICAgICAgICAgICAgIHdoaWxlIHRydWUKICAgICAgICAgICAgICAgICAgICBkbwogICAgICAgICAgICAgICAgICAgIC4vYmluL2ZsaW5rIHJ1biAuL2V4YW1wbGVzL2JhdGNoL0VudW1UcmlhbmdsZXMuamFyIC0tam9ibWFuYWdlciBmbGluay1qb2JtYW5hZ2VyOnt7IC5WYWx1ZXMuam9ibWFuYWdlci5zZXJ2aWNlLnBvcnRzLnJwYyB9fSAtRHJlc3QucG9ydD17eyAuVmFsdWVzLmpvYm1hbmFnZXIuc2VydmljZS5wb3J0cy5odHRwIH19CiAgICAgICAgICAgICAgICAgICAgZWNobyAiMSIgPiAvdG1wL3JlYWR5CiAgICAgICAgICAgICAgICAgICAgZG9uZQogICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgIHN0YXJ0dXBQcm9iZToKICAgICAgICAgICAgICAgIGV4ZWM6CiAgICAgICAgICAgICAgICAgIGNvbW1hbmQ6CiAgICAgICAgICAgICAgICAgICAgLSBzaAogICAgICAgICAgICAgICAgICAgIC0gLWMKICAgICAgICAgICAgICAgICAgICAtIHwKICAgICAgICAgICAgICAgICAgICAgIGlmIFsgJChjYXQgL3RtcC9yZWFkeSkgPSAiMSIgXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBleGl0IDAKICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgICAgaW5pdGlhbERlbGF5U2Vjb25kczogNDAKICAgICAgICAgICAgICAgIHBlcmlvZFNlY29uZHM6IDIwCiAgICAgICAgICAgICAgICB0aW1lb3V0U2Vjb25kczogMQogICAgICAgICAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogMTUKICAgICAgICAgICAgICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IDEKICAgICAgICAgICAgICB2b2x1bWVNb3VudHM6CiAgICAgICAgICAgICAgICAtIG5hbWU6IGZsaW5rLWNvbmZpZy12b2x1bWUKICAgICAgICAgICAgICAgICAgbW91bnRQYXRoOiAvb3B0L2JpdG5hbWkvZmxpbmsvY29uZgogICAgICAgICAgdm9sdW1lczoKICAgICAgICAgICAgLSBuYW1lOiBmbGluay1jb25maWctdm9sdW1lCiAgICAgICAgICAgICAgY29uZmlnTWFwOgogICAgICAgICAgICAgICAgbmFtZTogZmxpbmstam9iLWNvbmZpZwogICAgICAgICAgICAgICAgaXRlbXM6CiAgICAgICAgICAgICAgICAgIC0ga2V5OiBmbGluay1jb25mLnlhbWwKICAgICAgICAgICAgICAgICAgICBwYXRoOiBmbGluay1jb25mLnlhbWwKCiAgLSB8CiAgICBhcGlWZXJzaW9uOiB2MQogICAga2luZDogQ29uZmlnTWFwCiAgICBtZXRhZGF0YToKICAgICAgbmFtZTogZmxpbmstam9iLWNvbmZpZwogICAgICBuYW1lc3BhY2U6IHt7IGluY2x1ZGUgImNvbW1vbi5uYW1lcy5uYW1lc3BhY2UiIC4gfCBxdW90ZSB9fQogICAgICBsYWJlbHM6IHt7LSBpbmNsdWRlICJjb21tb24ubGFiZWxzLnN0YW5kYXJkIiAuIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGlmIC5WYWx1ZXMuY29tbW9uTGFiZWxzIH19CiAgICAgICAge3stIGluY2x1ZGUgImNvbW1vbi50cGx2YWx1ZXMucmVuZGVyIiAoIGRpY3QgInZhbHVlIiAuVmFsdWVzLmNvbW1vbkxhYmVscyAiY29udGV4dCIgJCApIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGVuZCB9fQogICAgICAgIGFwcC5rdWJlcm5ldGVzLmlvL3BhcnQtb2Y6IGZsaW5rCiAgICAgIHt7LSBpZiAuVmFsdWVzLmNvbW1vbkFubm90YXRpb25zIH19CiAgICAgIGFubm90YXRpb25zOiB7ey0gaW5jbHVkZSAiY29tbW9uLnRwbHZhbHVlcy5yZW5kZXIiICggZGljdCAidmFsdWUiIC5WYWx1ZXMuY29tbW9uQW5ub3RhdGlvbnMgImNvbnRleHQiICQgKSB8IG5pbmRlbnQgNCB9fQogICAgICB7ey0gZW5kIH19CiAgICBkYXRhOgogICAgICBmbGluay1jb25mLnlhbWw6IHwrCiAgICAgICAgam9ibWFuYWdlci5ycGMuYWRkcmVzczogZmxpbmstam9ibWFuYWdlcgogICAgICAgIGpvYm1hbmFnZXIucnBjLnBvcnQ6IDY1NTcKICAgICAgICByZXN0LmFkZHJlc3M6IGZsaW5rLWpvYm1hbmFnZXIKICAgICAgICByZXN0LmJpbmQtYWRkcmVzczogMC4wLjAuMAogICAgICAgIGJsb2Iuc2VydmVyLnBvcnQ6IDYxMjQKICAgICAgICBxdWVyeS5zZXJ2ZXIucG9ydDogNjEyNQogICAgICAgIHJlc3QucG9ydDogODAKCmpvYm1hbmFnZXI6CiAgY29udGFpbmVyUG9ydHM6CiAgICBycGM6IDY1NTUKICAgIGh0dHA6IDgwNzgKICBzZXJ2aWNlOgogICAgdHlwZTogTG9hZEJhbGFuY2VyCiAgICBwb3J0czoKICAgICAgcnBjOiA2NTU3CiAgICAgIGh0dHA6IDgwCiAgcG9kU2VjdXJpdHlDb250ZXh0OgogICAgZnNHcm91cDogMTAwMgogIGNvbnRhaW5lclNlY3VyaXR5Q29udGV4dDoKICAgIHJ1bkFzVXNlcjogMTAwMgp0YXNrbWFuYWdlcjoKICBzZXJ2aWNlOgogICAgcG9ydHM6CiAgICAgIHJwYzogMTQyNzIKICBjb250YWluZXJQb3J0czoKICAgIHJwYzogNTc3OQo=",
        "target_platform": {
          "target_platform_id": "{VIB_ENV_TARGET_PLATFORM}",
          "size": {
            "name": "M4"
          }
        }
      },
      "actions": [
        {
          "action_id": "health-check",
          "params": {
            "endpoint": "lb-flink-jobmanager-http",
            "app_protocol": "HTTP"
          }
        },
        {
          "action_id": "goss",
          "params": {
            "resources": {
              "path": "/.vib/flink/goss"
            },
            "remote": {
              "workload": "deploy-flink-jobmanager"
            },
            "vars_file": "vars.yaml"
          }
        },
        {
          "action_id": "cypress",
          "params": {
            "resources": {
              "path": "/.vib/flink/cypress"
            },
            "endpoint": "lb-flink-jobmanager-http",
            "app_protocol": "HTTP"
          }
        }
      ]
    }
  }
}
