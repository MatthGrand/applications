{
  "phases": {
    "package": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        }
      },
      "actions": [
        {
          "action_id": "helm-package"
        },
        {
          "action_id": "helm-lint"
        }
      ]
    },
    "verify": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/flink"
        },
        "runtime_parameters": "ZXh0cmFEZXBsb3k6CiAgLSB8CiAgICBhcGlWZXJzaW9uOiBiYXRjaC92MQogICAga2luZDogSm9iCiAgICBtZXRhZGF0YToKICAgICAgbmFtZTogZmxpbmstam9iLXJ1bm5lcgogICAgICBuYW1lc3BhY2U6IHt7IGluY2x1ZGUgImNvbW1vbi5uYW1lcy5uYW1lc3BhY2UiIC4gfCBxdW90ZSB9fQogICAgICBsYWJlbHM6IHt7LSBpbmNsdWRlICJjb21tb24ubGFiZWxzLnN0YW5kYXJkIiAuIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGlmIC5WYWx1ZXMuY29tbW9uTGFiZWxzIH19CiAgICAgICAge3stIGluY2x1ZGUgImNvbW1vbi50cGx2YWx1ZXMucmVuZGVyIiAoIGRpY3QgInZhbHVlIiAuVmFsdWVzLmNvbW1vbkxhYmVscyAiY29udGV4dCIgJCApIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGVuZCB9fQogICAgICAgIGFwcC5rdWJlcm5ldGVzLmlvL3BhcnQtb2Y6IGZsaW5rCiAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vY29tcG9uZW50OiBqb2JtYW5hZ2VyCiAgICAgIHt7LSBpZiAuVmFsdWVzLmNvbW1vbkFubm90YXRpb25zIH19CiAgICAgIGFubm90YXRpb25zOiB7ey0gaW5jbHVkZSAiY29tbW9uLnRwbHZhbHVlcy5yZW5kZXIiICggZGljdCAidmFsdWUiIC5WYWx1ZXMuY29tbW9uQW5ub3RhdGlvbnMgImNvbnRleHQiICQgKSB8IG5pbmRlbnQgNCB9fQogICAgICB7ey0gZW5kIH19CiAgICBzcGVjOgogICAgICB0ZW1wbGF0ZToKICAgICAgICBtZXRhZGF0YToKICAgICAgICAgIGxhYmVsczoge3stIGluY2x1ZGUgImNvbW1vbi5sYWJlbHMuc3RhbmRhcmQiIC4gfCBuaW5kZW50IDggfX0KICAgICAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vcGFydC1vZjogZmxpbmsKICAgICAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vY29tcG9uZW50OiBqb2JtYW5hZ2VyCiAgICAgICAgICAgIHt7LSBpZiAuVmFsdWVzLmpvYm1hbmFnZXIucG9kTGFiZWxzIH19CiAgICAgICAgICAgIHt7LSBpbmNsdWRlICJjb21tb24udHBsdmFsdWVzLnJlbmRlciIgKGRpY3QgInZhbHVlIiAuVmFsdWVzLmpvYm1hbmFnZXIucG9kTGFiZWxzICJjb250ZXh0IiAkKSB8IG5pbmRlbnQgOCB9fQogICAgICAgICAgICB7ey0gZW5kIH19CiAgICAgICAgICB7ey0gaWYgLlZhbHVlcy5qb2JtYW5hZ2VyLnBvZEFubm90YXRpb25zIH19CiAgICAgICAgICBhbm5vdGF0aW9uczoKICAgICAgICAgICAge3stIGlmIC5WYWx1ZXMuam9ibWFuYWdlci5wb2RBbm5vdGF0aW9ucyB9fQogICAgICAgICAgICB7ey0gaW5jbHVkZSAiY29tbW9uLnRwbHZhbHVlcy5yZW5kZXIiIChkaWN0ICJ2YWx1ZSIgLlZhbHVlcy5qb2JtYW5hZ2VyLnBvZEFubm90YXRpb25zICJjb250ZXh0IiAkKSB8IG5pbmRlbnQgOCB9fQogICAgICAgICAgICB7ey0gZW5kIH19CiAgICAgICAgICB7ey0gZW5kIH19CiAgICAgICAgc3BlYzoKICAgICAgICAgIHJlc3RhcnRQb2xpY3k6IE9uRmFpbHVyZQogICAgICAgICAgY29udGFpbmVyczoKICAgICAgICAgICAgLSBuYW1lOiBqb2ItcnVubmVyCiAgICAgICAgICAgICAgaW1hZ2U6IGRvY2tlci5pby9iaXRuYW1pL2ZsaW5rOjEuMTYuMS1kZWJpYW4tMTEtcjAKICAgICAgICAgICAgICBpbWFnZVB1bGxQb2xpY3k6IHt7IC5WYWx1ZXMuaW1hZ2UucHVsbFBvbGljeSB8IHF1b3RlIH19CiAgICAgICAgICAgICAgY29tbWFuZDoKICAgICAgICAgICAgICAgIC0gL2Jpbi9iYXNoCiAgICAgICAgICAgICAgYXJnczoKICAgICAgICAgICAgICAgIC0gLWVjCiAgICAgICAgICAgICAgICAtIHwKICAgICAgICAgICAgICAgICAgIyEvYmluL2Jhc2gKICAgIAogICAgICAgICAgICAgICAgICBzZXQgLW8gZXJyZXhpdAogICAgICAgICAgICAgICAgICBzZXQgLW8gbm91bnNldAogICAgICAgICAgICAgICAgICBzZXQgLW8gcGlwZWZhaWwKICAgIAogICAgICAgICAgICAgICAgICAuIC9vcHQvYml0bmFtaS9zY3JpcHRzL2xpYm9zLnNoCiAgICAKICAgICAgICAgICAgICAgICAgc2xlZXAgaW5maW5pdHkKICAgIAogICAgICAgICAgICAgICAgICBqb2JtYW5hZ2VyX3JlYWR5KCkgewogICAgICAgICAgICAgICAgICAgICAgIyBTZXQgdGhlIGVuZHBvaW50IFVSTAogICAgICAgICAgICAgICAgICAgICAgaG9zdD1mbGluay1qb2JtYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAgICBwb3J0PXt7IC5WYWx1ZXMuam9ibWFuYWdlci5jb250YWluZXJQb3J0cy5ycGMgfX0KICAgIAogICAgICAgICAgICAgICAgICAgICAgIyBUZXN0IHRoZSBUQ1AgY29ubmVjdGlvbiB3aXRoIGEgdGltZW91dAogICAgICAgICAgICAgICAgICAgICAgaWYgdGltZW91dCA1IGJhc2ggLWMgIjwvZGV2L3RjcC8kaG9zdC8kcG9ydCI7IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgICAgICAgZWNobyAiMCIgPiAvdG1wL3JlYWR5CiAgICAgICAgICAgICAgICAgIGluZm8gIldhaXRpbmcgZm9yIHRoZSBKb2JtYW5hZ2VyIGluc3RhbmNlIgogICAgICAgICAgICAgICAgICBpZiAhIHJldHJ5X3doaWxlICJqb2JtYW5hZ2VyX3JlYWR5IiAxMiAzMDsgdGhlbgogICAgICAgICAgICAgICAgICAgIGVycm9yICJDb3VsZCBub3QgY29ubmVjdCB0byB0aGUgSm9ibWFuYWdlciBpbnN0YW5jZSIKICAgICAgICAgICAgICAgICAgICBleGl0IDEKICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGluZm8gIkpvYm1hbmFnZXIgcmVhZHkhIFJ1bm5pbmcgam9iIGluIDEwIHNlY29uZHMiCiAgICAgICAgICAgICAgICAgICAgc2xlZXAgMTAKICAgICAgICAgICAgICAgICAgICB3aGlsZSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgICAgICAuL2Jpbi9mbGluayBydW4gLi9leGFtcGxlcy9iYXRjaC9FbnVtVHJpYW5nbGVzLmphciAtLWpvYm1hbmFnZXIgZmxpbmstam9ibWFuYWdlcjo2MTIzCiAgICAgICAgICAgICAgICAgICAgZWNobyAiMSIgPiAvdG1wL3JlYWR5CiAgICAgICAgICAgICAgICAgICAgZG9uZQogICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgIHN0YXJ0dXBQcm9iZToKICAgICAgICAgICAgICAgIGV4ZWM6CiAgICAgICAgICAgICAgICAgIGNvbW1hbmQ6CiAgICAgICAgICAgICAgICAgICAgLSBzaAogICAgICAgICAgICAgICAgICAgIC0gLWMKICAgICAgICAgICAgICAgICAgICAtIHwKICAgICAgICAgICAgICAgICAgICAgIGlmIFsgJChjYXQgL3RtcC9yZWFkeSkgPSAiMSIgXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBleGl0IDAKICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgICAgaW5pdGlhbERlbGF5U2Vjb25kczogMjAKICAgICAgICAgICAgICAgIHBlcmlvZFNlY29uZHM6IDEwCiAgICAgICAgICAgICAgICB0aW1lb3V0U2Vjb25kczogMQogICAgICAgICAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogMTUKICAgICAgICAgICAgICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IDEKICAgICAgICAgICAgICB2b2x1bWVNb3VudHM6CiAgICAgICAgICAgICAgICAtIG5hbWU6IGZsaW5rLWNvbmZpZy12b2x1bWUKICAgICAgICAgICAgICAgICAgbW91bnRQYXRoOiAvb3B0L2JpdG5hbWkvZmxpbmsvY29uZgogICAgICAgICAgdm9sdW1lczoKICAgICAgICAgICAgLSBuYW1lOiBmbGluay1jb25maWctdm9sdW1lCiAgICAgICAgICAgICAgY29uZmlnTWFwOgogICAgICAgICAgICAgICAgbmFtZTogZmxpbmstam9iLWNvbmZpZwogICAgICAgICAgICAgICAgaXRlbXM6CiAgICAgICAgICAgICAgICAgIC0ga2V5OiBmbGluay1jb25mLnlhbWwKICAgICAgICAgICAgICAgICAgICBwYXRoOiBmbGluay1jb25mLnlhbWwKCiAgLSB8CiAgICBhcGlWZXJzaW9uOiB2MQogICAga2luZDogQ29uZmlnTWFwCiAgICBtZXRhZGF0YToKICAgICAgbmFtZTogZmxpbmstam9iLWNvbmZpZwogICAgICBuYW1lc3BhY2U6IHt7IGluY2x1ZGUgImNvbW1vbi5uYW1lcy5uYW1lc3BhY2UiIC4gfCBxdW90ZSB9fQogICAgICBsYWJlbHM6IHt7LSBpbmNsdWRlICJjb21tb24ubGFiZWxzLnN0YW5kYXJkIiAuIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGlmIC5WYWx1ZXMuY29tbW9uTGFiZWxzIH19CiAgICAgICAge3stIGluY2x1ZGUgImNvbW1vbi50cGx2YWx1ZXMucmVuZGVyIiAoIGRpY3QgInZhbHVlIiAuVmFsdWVzLmNvbW1vbkxhYmVscyAiY29udGV4dCIgJCApIHwgbmluZGVudCA0IH19CiAgICAgICAge3stIGVuZCB9fQogICAgICAgIGFwcC5rdWJlcm5ldGVzLmlvL3BhcnQtb2Y6IGZsaW5rCiAgICAgICAgYXBwLmt1YmVybmV0ZXMuaW8vY29tcG9uZW50OiBqb2JtYW5hZ2VyCiAgICAgIHt7LSBpZiAuVmFsdWVzLmNvbW1vbkFubm90YXRpb25zIH19CiAgICAgIGFubm90YXRpb25zOiB7ey0gaW5jbHVkZSAiY29tbW9uLnRwbHZhbHVlcy5yZW5kZXIiICggZGljdCAidmFsdWUiIC5WYWx1ZXMuY29tbW9uQW5ub3RhdGlvbnMgImNvbnRleHQiICQgKSB8IG5pbmRlbnQgNCB9fQogICAgICB7ey0gZW5kIH19CiAgICBkYXRhOgogICAgICBmbGluay1jb25mLnlhbWw6IHwrCiAgICAgICAgam9ibWFuYWdlci5ycGMuYWRkcmVzczogZmxpbmstam9ibWFuYWdlcgogICAgICAgIGpvYm1hbmFnZXIucnBjLnBvcnQ6IDYxMjMKICAgICAgICBibG9iLnNlcnZlci5wb3J0OiA2MTI0CiAgICAgICAgcXVlcnlhYmxlLXN0YXRlLnByb3h5LnBvcnRzOiA2MTI1CiAgICAgICAgam9ibWFuYWdlci5tZW1vcnkucHJvY2Vzcy5zaXplOiAxNjAwbQoK",
        "target_platform": {
          "target_platform_id": "{VIB_ENV_TARGET_PLATFORM}",
          "size": {
            "name": "M4"
          }
        }
      },
      "actions": [
        {
          "action_id": "health-check",
          "params": {
            "endpoint": "lb-flink-jobmanager-web",
            "app_protocol": "HTTP"
          }
        },
        {
          "action_id": "goss",
          "params": {
            "resources": {
              "path": "/.vib/flink/goss"
            },
            "remote": {
              "workload": "deploy-flink-jobmanager"
            },
            "vars_file": "vars.yaml"
          }
        },
        {
          "action_id": "cypress",
          "params": {
            "resources": {
              "path": "/.vib/flink/cypress"
            },
            "endpoint": "lb-flink-jobmanager-web",
            "app_protocol": "HTTP"
          }
        }
      ]
    }
  }
}
