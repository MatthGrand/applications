port:
  tcp6:3306:
    listening: true
    ip:
    - '::'
process:
  mysqld:
    running: true
file:   
  /bitnami/mariadb/data/test_database:
    mode: "0644"
    filetype: directory
    exists: true
    group: root
  /opt/bitnami/mariadb/conf/my.cnf:
    mode: "0644"
    filetype: file
    contains: [
      "[mysqld]",
      "basedir=/opt/bitnami/mariadb",
      "socket=/opt/bitnami/mariadb/tmp/mysql.sock"]
    exists: true
    group: root  
command:
  user-id-test:
    exec: if [ "$(id -u)" -eq 0 ]; then exit 1; fi
    exit-status: 0
    stdout: []
    stderr: []
  which-mariadb-test:
    exec: which mariadb
    exit-status: 0
    stdout: 
      - /opt/bitnami/mariadb/bin/mariadb
    stderr: []
  mariadb -h localhost -u root -p{{getEnv "MARIADB_ROOT_PASSWORD"}}  {{getEnv "MARIADB_DATABASE"}}  -e 'DROP TABLE IF EXISTS TEST; create table TEST( test_id int auto_increment, test_value int, primary key(test_id)); INSERT INTO TEST (TEST_VALUE) VALUES (-1);SELECT * FROM TEST':
    title: Validating that we can log in with $MARIADB_ROOT_PASSWORD, create a table, insert and retrieve the value inserted
    exit-status: 0
    stdout:
    - -1
    stderr: []
    timeout: 9000
  mariadb -h localhost -u {{getEnv "MARIADB_USER"}} -p{{getEnv "MARIADB_PASSWORD"}}  {{getEnv "MARIADB_DATABASE"}}  -e 'DROP TABLE IF EXISTS TEST_U; create table TEST_U( test_id int auto_increment, test_value int, primary key(test_id)); INSERT INTO TEST_U (TEST_VALUE) VALUES (-1);SELECT * FROM TEST_U':
    title: Validating that we can log in with MARIADB_USER MARIADB_PASSWORD in MARIADB_DATABASE
    exit-status: 0
    stdout:
    - -1
    stderr: []
    timeout: 9000
