{
  "phases": {
    "package": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/nginx-ingress-controller"
        }
      },
      "actions": [
        {
          "action_id": "helm-package"
        },
        {
          "action_id": "helm-lint"
        }
      ]
    },
    "verify": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/nginx-ingress-controller"
        },
        "runtime_parameters": "aW5ncmVzc0NsYXNzUmVzb3VyY2U6CiAgbmFtZTogbmdpbngKICBlbmFibGVkOiB0cnVlCiAgZGVmYXVsdDogZmFsc2UKICBjb250cm9sbGVyQ2xhc3M6ICJrOHMuaW8vaW5ncmVzcy1uZ2lueCIKa2luZDogRGVwbG95bWVudApwb2RTZWN1cml0eUNvbnRleHQ6CiAgZW5hYmxlZDogdHJ1ZQogIGZzR3JvdXA6IDEwMDIKY29udGFpbmVyU2VjdXJpdHlDb250ZXh0OgogIGVuYWJsZWQ6IHRydWUKICBydW5Bc1VzZXI6IDEwMDIKICBjYXBhYmlsaXRpZXM6CiAgICBkcm9wOiBbIkFMTCJdCiAgICBhZGQ6IFsiTkVUX0JJTkRfU0VSVklDRSJdCmRlZmF1bHRCYWNrZW5kOgogIGVuYWJsZWQ6IHRydWUKICBjb250YWluZXJQb3J0OiA4MDgwCiAgc2VydmVyQmxvY2tDb25maWc6IHwtCiAgICBsb2NhdGlvbiAvaGVhbHRoeiB7CiAgICAgIHJldHVybiAyMDA7CiAgICB9CiAgICBsb2NhdGlvbiAvIHsKICAgICAgcmV0dXJuIDQwNDsKICAgIH0Kc2VydmljZToKICBwb3J0czogCiAgICBodHRwOiA4MAogICAgaHR0cHM6IDQ0NAogIHR5cGU6IExvYWRCYWxhbmNlcgpzZXJ2aWNlQWNjb3VudDoKICBjcmVhdGU6IHRydWUKICBhdXRvbW91bnRTZXJ2aWNlQWNjb3VudFRva2VuOiB0cnVlCmV4dHJhRGVwbG95OgotIGFwaVZlcnNpb246IGFwcHMvdjEKICBraW5kOiBEZXBsb3ltZW50CiAgbWV0YWRhdGE6CiAgICBsYWJlbHM6CiAgICAgIGFwcDoga3VhcmQKICAgIG5hbWU6IGt1YXJkCiAgc3BlYzoKICAgIHJlcGxpY2FzOiAxCiAgICBzZWxlY3RvcjoKICAgICAgbWF0Y2hMYWJlbHM6CiAgICAgICAgYXBwOiBrdWFyZAogICAgdGVtcGxhdGU6CiAgICAgIG1ldGFkYXRhOgogICAgICAgIGxhYmVsczoKICAgICAgICAgIGFwcDoga3VhcmQKICAgICAgc3BlYzoKICAgICAgICBjb250YWluZXJzOgogICAgICAgIC0gaW1hZ2U6IGdjci5pby9rdWFyLWRlbW8va3VhcmQtYW1kNjQ6MQogICAgICAgICAgbmFtZToga3VhcmQKLSBhcGlWZXJzaW9uOiB2MQogIGtpbmQ6IFNlcnZpY2UKICBtZXRhZGF0YToKICAgIGxhYmVsczoKICAgICAgYXBwOiBrdWFyZAogICAgbmFtZToga3VhcmQtdmliCiAgc3BlYzoKICAgIHBvcnRzOgogICAgLSBwb3J0OiA4MAogICAgICBwcm90b2NvbDogVENQCiAgICAgIHRhcmdldFBvcnQ6IDgwODAKICAgICAgbmFtZTogaHR0cAogICAgLSBwb3J0OiA0NDMKICAgICAgcHJvdG9jb2w6IFRDUAogICAgICB0YXJnZXRQb3J0OiA0NDMKICAgICAgbmFtZTogaHR0cHMKICAgIHNlbGVjdG9yOgogICAgICBhcHA6IGt1YXJkCiAgICBzZXNzaW9uQWZmaW5pdHk6IE5vbmUKICAgIHR5cGU6IENsdXN0ZXJJUA==",
        "target_platform": {
          "target_platform_id": "{VIB_ENV_ALTERNATIVE_TARGET_PLATFORM}",
          "size": {
            "name": "S4"
          }
        }
      },
      "actions": [
        {
          "action_id": "health-check",
          "params": {
            "endpoint": "lb-nginx-ingress-controller-http",
            "app_protocol": "HTTP"
          }
        },
        {
          "action_id": "goss",
          "params": {
            "resources": {
              "path": "/.vib/nginx-ingress-controller/goss"
            },
            "remote": {
              "workload": "deploy-nginx-ingress-controller"
            },
            "vars_file": "vars.yaml"
          }
        },
        {
          "action_id": "ginkgo",
          "params": {
            "resources": {
              "path": "/.vib/nginx-ingress-controller/ginkgo"

            },
            "params": {
              "kubeconfig": "{{kubeconfig}}",
              "namespace": "{{namespace}}",
              "service-name": "kuard-vib"
            }
          }
        }
      ]
    },
    "publish": {
      "actions": [
        {
          "action_id": "helm-publish",
          "params": {
            "repository": {
              "kind": "S3",
              "url": "{VIB_ENV_S3_URL}",
              "username": "{VIB_ENV_S3_USERNAME}",
              "password": "{VIB_ENV_S3_PASSWORD}"
            }
          }
        }
      ]
    }
  }
}
