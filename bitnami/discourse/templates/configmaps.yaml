apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "discourse.fullname" . }}
  labels: {{- include "discourse.labels" . | nindent 4 }}
data:
  DISCOURSE_HOSTNAME: {{ .Values.discourseHost }}
  DISCOURSE_USERNAME: {{ .Values.discourseUsername }}
  DISCOURSE_EMAIL: {{ .Values.discourseEmail }}
  DISCOURSE_SITENAME: {{ .Values.sitename }}
  {{- if .Values.postgresql.enabled }}
  POSTGRESQL_HOST: {{ template "discourse.postgresql.fullname" . }}
  POSTGRESQL_ROOT_USER: "postgres"
  POSTGRESQL_CLIENT_CREATE_DATABASE_NAME: {{ .Values.postgresql.postgresqlDatabase }}
  POSTGRESQL_CLIENT_CREATE_DATABASE_USERNAME: {{ .Values.postgresql.postgresqlUsername }}
  DISCOURSE_POSTGRESQL_NAME: {{ .Values.postgresql.postgresqlDatabase }}
  DISCOURSE_POSTGRESQL_USERNAME: {{ .Values.postgresql.postgresqlUsername }}
  {{- else }}
  POSTGRESQL_HOST: {{ .Values.externalDatabase.host | quote }}
  DISCOURSE_POSTGRESQL_NAME: {{ .Values.externalDatabase.database }}
  DISCOURSE_POSTGRESQL_USERNAME: {{ .Values.externalDatabase.user }}
  {{- end }}
  REDIS_HOST: {{ include "discourse.fullname" . }}-redis-master
  REDIS_PORT_NUMBER: "6379"
  {{- if .Release.IsUpgrade }}
  DISCOURSE_SKIP_INSTALL: "yes"
  {{- end }}
