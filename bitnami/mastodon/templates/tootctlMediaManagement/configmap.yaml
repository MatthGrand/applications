apiVersion: v1
kind: ConfigMap
metadata:
  name: tootctl-media-management-configmap
data:
  media-cache-manage.sh: |
    set -o errexit
    set -o nounset
    set -o pipefail
    # set -o xtrace # Uncomment this line for debugging purposes
    # Load libraries
    . /opt/bitnami/scripts/liblog.sh
    . /opt/bitnami/scripts/libos.sh
    . /opt/bitnami/scripts/libvalidations.sh
    . /opt/bitnami/scripts/libmastodon.sh
    # Load Mastodon environment variables
    . /opt/bitnami/scripts/mastodon-env.sh
    # Load Mastodon configuration
    eval "$(mastodon_runtime_env)"
    #List usage
    #tootctl media usage
    
    #Attachements:
    tootctl media remove --days=7
    #Remote Custom Emoji (remote)
    tootctl emoji purge --remote-only
    #Preview cards:
    tootctl preview_cards remove --days=7
    #Avatars and Deaders
    tootctl media remove --prune-profiles --include-follows --days=7
    #Headers only:
    #tootctl media remove --remove-headers --include-follows --days=7
    #Orphaned files
    tootctl media remove-orphans
